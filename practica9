--Задание 1: Количество товаров по категориям
SELECT
    category,
    COUNT(product_id) AS products_in_category
FROM Products
GROUP BY category;
--Задание 2: Общая выручка
SELECT
    SUM(quantity * price_per_unit) AS total_revenue
FROM Order_Items;

--Задание 3: Количество заказов на клиента
SELECT
    c.full_name,
    COUNT(o.order_id) AS orders_count
FROM Customers c
LEFT JOIN Orders o ON c.customer_id = o.customer_id
GROUP BY c.full_name;
--Задание 4: Средний чек
SELECT
    AVG(order_total) AS average_check
FROM (
    SELECT
        o.order_id,
        SUM(oi.quantity * oi.price_per_unit) AS order_total
    FROM Orders o
    JOIN Order_Items oi ON o.order_id = oi.order_id
    GROUP BY o.order_id
) AS order_totals;
--Задание 5: Статус заказов
SELECT
    status,
    COUNT(order_id) AS orders_count
FROM Orders
GROUP BY status;
--Задание 6: "Крупные" категории (HAVING)
SELECT
    category,
    COUNT(product_id) AS products_in_category
FROM Products
GROUP BY category
HAVING COUNT(product_id) > 1;
--Задание 7: "Лояльные" клиенты (HAVING)
SELECT
    c.full_name,
    COUNT(o.order_id) AS orders_count
FROM Customers c
JOIN Orders o ON c.customer_id = o.customer_id
GROUP BY c.full_name
HAVING COUNT(o.order_id) > 1;
--Задание 8 (со звездочкой): Самый продаваемый товар
SELECT
    p.product_name,
    SUM(oi.quantity) AS total_units_sold
FROM Products p
JOIN Order_Items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.product_name
ORDER BY total_units_sold DESC
LIMIT 1;
